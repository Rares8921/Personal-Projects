<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<script>(function(){document.documentElement.className=localStorage.getItem('theme')||'light'})();</script>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Garage Door Control</title>
<link rel="stylesheet" th:href="@{/css/style.css}"/><link rel="stylesheet" th:href="@{/css/device_control.css}"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous"/>
<script defer src="/script/theme-toggle.js"></script>
</head>
<body class="light">
<div th:replace="~{fragments :: headerFrag}"></div>
<main class="container">
    <h2><i class="fas fa-warehouse"></i> Garage Door Control</h2>
    <div id="message"></div>
    <div class="status-panel" id="statusPanel">Loading…</div>
    <div class="control-groups">
        <div class="control-group"><label>Door</label>
            <button id="openBtn"><i class="fas fa-door-open"></i> Open</button>
            <button id="closeBtn" style="margin-top:.5rem"><i class="fas fa-door-closed"></i> Close</button>
        </div>
        <div class="control-group"><label>Auto-Close</label>
            <select id="autoClose"><option value="true">Enabled</option><option value="false">Disabled</option></select>
        </div>
        <div class="control-group"><label>Auto-Close Delay (seconds)</label>
            <input id="autoCloseDelay" type="number" min="5" max="300" value="30"/>
        </div>
    </div>
    <div class="actions">
        <button id="saveBtn"><i class="fas fa-save"></i> Save</button>
        <button id="backBtn"><i class="fas fa-arrow-left"></i> Back</button>
    </div>
</main>
<div th:replace="~{fragments :: footerFrag}"></div>
<script src="/script/main.js"></script>
<script>
const params=new URLSearchParams(location.search),id=params.get("id"),API="/api/garagedoor";
async function load(){const r=await fetch(`${API}/${id}`);const d=await r.json();const stateColor=d.doorState==="CLOSED"?"on":"off";document.getElementById("statusPanel").innerHTML=`<span class="status-badge ${stateColor}">${d.doorState}</span> <strong>${d.name}</strong> — Auto-close: ${d.autoClose?"Yes":"No"}, Delay: ${d.autoCloseDelay}s`;document.getElementById("autoClose").value=String(d.autoClose);document.getElementById("autoCloseDelay").value=d.autoCloseDelay}
async function save(){await fetch(`${API}/${id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({autoClose:document.getElementById("autoClose").value==="true",autoCloseDelay:+document.getElementById("autoCloseDelay").value})});document.getElementById("message").textContent="Saved!";load()}
async function openDoor(){await fetch(`${API}/${id}/open`,{method:"POST"});load()}
async function closeDoor(){await fetch(`${API}/${id}/close`,{method:"POST"});load()}
document.getElementById("openBtn").addEventListener("click",openDoor);
document.getElementById("closeBtn").addEventListener("click",closeDoor);
document.getElementById("saveBtn").addEventListener("click",save);
document.getElementById("backBtn").addEventListener("click",()=>location.href="/garagedoor_management");
load();
</script>
</body>
</html>
